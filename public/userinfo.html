<!doctype html>
<html lang="en"><!-- this is the overall document -->
    <head><!-- this section controls the page, but not directly displayed -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>User Info Page</title>
        <link href="./css/bootstrap.min.css" rel="stylesheet">
    </head>
    <body><!-- this section displays what's inside the page -->
        <div class="container text-center">
            <div class="row">
                <div class="col">

                </div>
                <div class="col">
                    <h1>Welcome</h1>
                        <div class="mb-3">
                            <label for="studentId" class="form-label">Student ID</label>
                            <input type="text" name="studentId" id="studentId" class="form-control" disabled/>
                        </div>
                        <div class="mb-3">
                            <label for="user" class="form-label">User</label>
                            <input type="text" name="user" id="user" class="form-control" disabled/>
                        </div>
                        <div class="mb-3">
                            <label for="major" class="form-label">Major</label>
                            <select class="form-select" name="major" id="major-field">
                            </select>
                        </div>
                        <div class="mb-3 d-grid gap-2"><!-- stretches the button -->
                            <button class="btn btn-success" id="view-courses-button">View Course Progress and Prereqs</button>
                        </div>
                        <div class="mb-3 d-grid gap-2"><!-- stretches the button -->
                            <button class="btn btn-success" id="logout-button">Logout</button>
                        </div>
                </div>
                <div class="col">

                </div>
            </div>
        </div>
    <script src="./js/bootstrap.bundle.min.js"></script>
    <script src="./js/mock-backend.js"></script>
    <script>
        const session = loadSession()
        if (!session.isLoggedIn()) {
            // redirect to login page if user is not logged in.
            // window.location.href = 'login.html'
            console.warn('not logged in for some reason', session)
        }
        const logoutButton = document.getElementById('logout-button')
        logoutButton.addEventListener('click', (event) => {
            event.stopPropagation()
            event.preventDefault()
            session.logout()
            window.location.href = 'login.html'
        })
        const majors = loadMajors()
        const studendIdField = document.getElementById('studentId')
        studendIdField.value = session.id
        const user = document.getElementById('user')
        user.value = session.name
        const majorField = document.getElementById('major-field')
        Object.keys(majors).forEach((key) => {
            const option = document.createElement('option')
            option.value = key
            if (session.major === key) {
                option.selected = true
            }
            option.innerHTML = majors[key].major
            majorField.appendChild(option)
        })
        majorField.addEventListener('change', function (event) {
            event.preventDefault()
            event.stopPropagation()
            const newMajor = majorField.value
            try {
                updateMajor(session.login, newMajor)
            } catch (e) {
                alert(e)
            }
        })
        const viewCoursesButton = document.getElementById('view-courses-button')
        viewCoursesButton.addEventListener('click', function (event) {
            event.preventDefault()
            event.stopPropagation()
            window.location.href = 'classes.html'
        })
    </script>
    </body>
</html>
